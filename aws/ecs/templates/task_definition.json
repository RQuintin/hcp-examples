[{
  "name": "consul-client",
  "image": "consul:1.8.3",
  "cpu": 10,
  "memory": 100,
  "portMappings": [
    {
      "containerPort": 8301,
      "protocol": "tcp"
    },
    {
      "containerPort": 8301,
      "protocol": "udp"
    },
    {
      "containerPort": 8302
    },
    {
      "containerPort": 8300
    },
    {
      "containerPort": 8600,
      "protocol": "tcp"
    },
    {
      "containerPort": 8600,
      "protocol": "udp"
    },
    {
      "containerPort": 8501,
      "hostPort": 8501
    },
    {
      "containerPort": 8502,
      "hostPort": 8502
    }
  ],
  "secrets": [
    {
      "name": "CONSUL_HTTP_TOKEN",
      "valueFrom": "${arn_consul_secret}:token::"
    },
    {
      "name": "CONSUL_CERTIFICATE",
      "valueFrom": "${arn_consul_secret}:certificate::"
    },
    {
      "name": "CONSUL_CONFIG",
      "valueFrom": "${arn_consul_secret}:client_config::"
    }
  ],
  "environment": [
    {
      "name": "CONSUL_BIND_INTERFACE",
      "value": "eth0"
    },
    {
      "name": "CONSUL_CLIENT_INTERFACE",
      "value": "lo"
    },
    {
      "name": "CONSUL_HTTP_SSL_VERIFY",
      "value": "false"
    }
  ],
  "command": [
    "sh",
    "-c",
    "mkdir -p /consul/config; echo $CONSUL_CERTIFICATE | base64 -d > /tmp/ca.pem; echo $CONSUL_CONFIG | base64 -d > /consul/config/client_config.json; docker-entrypoint.sh agent"
  ]
}]
{
  "containerDefinitions": [
    {
      "secrets": [
        {
          "name": "CONSUL_HTTP_TOKEN",
          "valueFrom": "${arn_consul_token}"
        },
        {
          "name": "CONSUL_CERTIFICATE",
          "valueFrom": "${arn_consul_certificate}"
        },
        {
          "name": "CONSUL_CONFIG",
          "valueFrom": "${arn_consul_config}"
        }
      ],
      "name": "consul-agent",
      "image": "consul:1.8.3",
      "cpu": 10,
      "memory": 100,
      "essential": true,
      "networkMode": "awsvpc",
      "portMappings": [
        {
          "containerPort": 8301,
          "hostPort": 8301
        }
      ],
      "environment": [
        {
          "name": "CONSUL_BIND_INTERFACE",
          "value": "eth0"
        },
        {
          "name": "CONSUL_CLIENT_INTERFACE",
          "value": "lo"
        }
      ],
      "entrypoint": [
        "sh",
        "-c",
        "set -ueo pipefail; echo $CONSUL_CERTIFICATE | base64 -d > ca.pem; echo $CONSUL_CONFIG | base64 -d > client_config.json; "
      ]
    }
  ]
}